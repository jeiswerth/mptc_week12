# Chunk 1
#| label = "load-libraries-data",
#| warning = FALSE,
#| message = FALSE
library(tidyverse)
library(here)
library(socviz)
## Mapping
library(sf)
## Install nycdogs (you should have this already, but if you don't, uncomment and run this line once)
# remotes::install_github("kjhealy/nycdogs)
## Census
library(tidycensus)
options(tigris_use_cache = TRUE)
## Activate your API key by uncommenting the next line and
## putting your key in the quotes
# census_api_key("YOUR_API_KEY_HERE")
## Optionally install this package
## remotes::install_github("kjhealy/nycomplaints")
## library(nycomplaints)
## But the datasets are also included in the project here.
load(here("data", "nycomplaints.rda"))
load(here("data", "census_vars.rda"))
load(here("data", "nyzip_demog.rda"))
census_vars
acs_vars <- tribble(
~varname, ~clean_name,
"B01003_001", "pop",
"B01001B_001", "black",
"B01001A_001", "white",
"B01001H_001", "nh_white",
"B01001I_001", "hispanic",
"B01001D_001", "asian",
"B19013_001", "median_hh_inc")
acs_vars
ny_county_boros <- tribble(
~county, ~borough,
"New York County, New York", "Manhattan",
"Queens County, New York", "Queens",
"Kings County, New York", "Brooklyn",
"Bronx County, New York", "Bronx",
"Richmond County, New York", "Staten Island"
)
ny_county_boros
zip_base <- nycdogs::nyc_zips |>
rename(zip = zip_code) |>
mutate(zip = as.character(zip))
zip_data <- get_acs(geography = "zcta",
variables = acs_vars$varname,
state = "NY",
year = 2019,
county = NULL,
geometry = TRUE) |>
rename(zip = GEOID) |>
select(-moe) |>
tibble::as_tibble() |>
pivot_wider(names_from = variable,
values_from = c(estimate)) |>
rename_with(~ acs_vars$clean_name,
all_of(acs_vars$varname)) |>
sf::st_as_sf() |>
relocate(geometry, .after = everything()) |>
filter(zip %in% zip_base$zip)
zip_data
get_acs(geography = "zcta",
variables = census_vars$varname,
state = "NY",
year = 2019,
county = NULL,
geometry = TRUE) |>
rename(zip = GEOID) |>
select(-moe) |>
tibble::as_tibble() |>
pivot_wider(names_from = variable,
values_from = c(estimate)) |>
rename_with(~ acs_vars$clean_name,
all_of(census_vars$varname)) |>
sf::st_as_sf() |>
relocate(geometry, .after = everything()) |>
filter(zip %in% zip_base$zip)
zip_data
zip_data |>
ggplot() +
geom_sf()
county_data <- get_acs(geography = "county",
variables = acs_vars$varname,
state = "NY",
geometry = TRUE) |>
rename(fips = GEOID,
county = NAME) |>
select(-moe) |>
tibble::as_tibble() |>
pivot_wider(names_from = variable,
values_from = c(estimate)) |>
rename_with(~ acs_vars$clean_name,
all_of(acs_vars$varname)) |>
filter(county %in% ny_county_boros$county) |>
left_join(ny_county_boros, by = "county") |>
select(fips, county, borough, everything()) |>
sf::st_as_sf() |>
relocate(geometry, .after = everything())
county_data
acs_vars <- load_variables(year = 2019, dataset = "acs5")
zip_data |>
st_drop_geometry()
nycomplaints
nyzip_demog
county_data
acs_vars
zip_data |>
st_drop_geometry()
zip_data
nycomplaints
#| label = "load-libraries-data",
#| warning = FALSE,
#| message = FALSE
library(tidyverse)
library(here)
library(socviz)
## Mapping
library(sf)
install.packages("sf")
#| label = "load-libraries-data",
#| warning = FALSE,
#| message = FALSE
library(tidyverse)
library(here)
library(socviz)
## Mapping
library(sf)
## Census
## Make sure you have a census API key! You only need one.
## https://api.census.gov/data/key_signup.html
library(tidycensus)
options(tigris_use_cache = TRUE)
## Install the data package:
## remotes::install_github("kjhealy/nycomplaints")
library(nycomplaints)
remotes::install_github("kjhealy/nycomplaints")
